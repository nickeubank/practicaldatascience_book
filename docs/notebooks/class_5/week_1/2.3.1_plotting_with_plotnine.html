
<!DOCTYPE html>


<html lang="en" data-content_root="../../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Plotnine and the Grammar of Graphics &#8212; Practical Data Science with Python</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-MC77BKR89Z"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MC77BKR89Z');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-MC77BKR89Z');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/class_5/week_1/2.3.1_plotting_with_plotnine';</script>
    <link rel="icon" href="../../../_static/mids_logo.svg"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../../_static/logo.png" class="logo__image only-light" alt="Practical Data Science with Python - Home"/>
    <script>document.write(`<img src="../../../_static/logo.png" class="logo__image only-dark" alt="Practical Data Science with Python - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../../intro.html">
                    Practical Data Science in Python
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Duke IDS Classes</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../../ids590_specific/class_schedule_590.html">PDS I (IDS 590)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ids591_specific/class_schedule_591.html">PDS II (IDS 591)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../ids720_specific/class_schedule_720.html">PDS (MIDS) (IDS 720)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Setting Up Your Environment</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/00_setup_env/setup_python.html">Setting Up Python and conda</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/00_setup_env/setup_vscode.html">Setting Up VS Code</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/00_setup_env/setup_augmented_commandline.html">Augmenting Your Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/00_setup_env/jupyter_in_vscode.html">Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/00_setup_env/jupyter_r_notebooks.html">VS Code, R, and Jupyter</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Command Line</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/10_commandline/commandline_part1.html">Command Line Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/10_commandline/commandline_part2.html">Advanced Command Line</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/10_commandline/git_and_github.html">Git and Github</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Numpy</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_2/week_2/10_why_numpy.html">Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/20_intro_to_vectors.html">Working with Vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/21_math_with_vectors.html">Doing Math With Vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/23_type_promotion_in_vectors.html">Type Promotion in numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_4/10_speed_and_ease_of_use.html">The Python Ease of Use / Speed Tradeoff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_4/11_vectorization.html">Vectorization in Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/24_vector_recap.html">Vector Recap</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_2/week_2/30_subsetting_vectors.html">Subsetting Vectors</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/35_modifying_subsets_of_vectors.html">Modifying Subsets of Vectors</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_2/37_vector_subsets_recap.html">Recap</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_2/week_3/10_views_and_copies.html">Views and Copies</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/11_when_do_I_get_a_view.html">When Do I Get a View and When Do I Get a Copy?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/13_objects_and_variables.html">Variables are pointers to objects</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/12_views_and_copies_recap.html">Review of Views and Copies</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_2/week_3/00_welcome_to_week_3.html">Matrices</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/20_matrices.html">Intro to Matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/22_reshaping_matrices.html">Folding and Reshaping Matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/25_images_as_matrices.html">Matrices as Images</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/30_subsetting_matrices.html">Subsetting Matrices</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/32_modifying_subsets.html">Editing Subsets</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/33_matrix_recaps.html">Review of Matrices</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_2/week_3/40_nd_arrays.html">Arrays</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/41_broadcasting.html">Broadcasting</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_3/42_nd_array_review.html">Review of ND-Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_4/03_summarizing_arrays.html">Summarizing Arrays</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_4/04_summarizing_arrays_example.html">Practical Example: comparing weather by counting like-values</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_2/week_4/04.1_color_images_as_arrays.html">Color Images as Arrays</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_2/week_4/20_random_numbers.html">Random numbers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Pandas</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_3/week_2/00_intro_to_pandas.html">Welcome to Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/10_pandas_series.html">Pandas Series</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/15_manipulating_series.html">Subsetting and Indexing Series</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/16_indexing_with_brackets.html">(OPTIONAL) Subsetting and Indexing with Single Square Brackets (<code class="docutils literal notranslate"><span class="pre">[]</span></code>)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/18_object_dtype.html">The <code class="docutils literal notranslate"><span class="pre">object</span></code> Data Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/30_pandas_dataframes.html">Working with tabular data through Dataframes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/35_pandas_dataframe_gotchas.html">Subsetting DataFrame Tricks and Gotchas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/45_categorical_dtype.html">The Categorical Data Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_2/50_pandas_pyarrow.html">PyArrow: An Alternative to Numpy as Pandas Backend</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_3/week_3/07_indices.html">Indexes</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_3/week_3/10_views_and_copies_numpy_review.html">Views and Copies in Pandas</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/15_views_and_copies_in_pandas.html">Views and Copies in pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/17_views_and_copies_in_pandas_wo_CoW.html">The View/Copy Headache in pandas without Copy on Write</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_3/week_3/03_plaintext_files.html">Reading Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/05_binary_files.html">Binary Data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_3/week_3/20_cleaning_identifying.html">Data Cleaning</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/30_cleaning_editing_globally.html">Fixing Data Value Problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/32_cleaning_editing_specific_locations.html">Editing Specific Locations</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/33_cleaning_datatypes.html">Cleaning Data Types</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_3/35_cleaning_missing_data.html">Missing Data</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../class_3/week_4/00_intro_to_querying_data.html">Data Manipulations</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/10_combining_concatenating.html">Concatenating</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/15_combining_merging.html">Merging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/15.1_combining_merging_continued.html">Combining datasets: merging</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/15.2_combining_merging_practical_example.html">Practical Example</a></li>

<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/15.3_validating_a_merge.html">Validating Merges</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/20_grouping.html">Grouping</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../class_3/week_4/30_queries.html">Querying</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Data Visualization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="1.1.2_effective_plotting_practices.html">Matplotlib Fundamentals</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="1.2.1_basic_plotting_with_matplotlib.html">Plotting with <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.2_ten_figure_pieces.html">A figure in 10 pieces</a></li>

<li class="toctree-l2"><a class="reference internal" href="1.4.5_explicit_vs_implicit_syntax.html">Implicit vs explicit syntax</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.4.4_saving_to_file.html">Saving to file</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.5.1_plotting_zoo.html">Plotting Zoo: multiple ways to visualize the same set of data</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.6.1_plotting_with_pandas.html">Plotting with Pandas</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="1.2.4_bar_plots_deep_dive.html">Different Types of Plots</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="1.2.3_text.html">Plotting text (and a side note on axis scaling)</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.5_stack_plots.html">Stack Plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.6_pie_charts.html">Pie charts</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.7.1_subplots.html">Subplots</a></li>

<li class="toctree-l2"><a class="reference internal" href="1.2.7.2_subplots_deep_dive.html">Subplots: a deeper dive</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.7.EXS_timeseries_worked_example.html">Exercise: Creating a subplot of timeseries (solution)</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.7.EX_timeseries_worked_example.html">Exercise: Creating a subplot of timeseries</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.7_scatter_plots_deep_dive.html">Doing more with scatter plots</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.2.8_errorbars.html">Visualizing ranges and uncertainty</a></li>

<li class="toctree-l2"><a class="reference internal" href="1.2.9_heat_maps.html">Heat maps</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3.1.EXS_histograms_solutions.html">Exercise: Analyzing Poker Hand Outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3.1.EX_histograms.html">Exercise: Analyzing Poker Hand Outcomes</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3.1_histograms.html">Histograms</a></li>
<li class="toctree-l2"><a class="reference internal" href="1.3.2_2d_histograms.html">Two Dimensional Histograms</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="2.1.1_the_matplotlib_model.html">Advanced Matplotlib</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="2.1.2_customizing_plot_styles.html">Customizing styles</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.1.3_plotting_zoo_restyled.html">Plotting Zoo - with style!</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.2.1_making_plots_pretty_1.html">Making Plots Pretty Part 1: laying the foundation</a></li>
<li class="toctree-l2"><a class="reference internal" href="2.2.2_making_plots_pretty_2.html">Making pretty plots in Python: customizing plots in <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code></a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="2.3.1_plotting_with_seaborn.html">Seaborn Objects and GoG</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="2.3.2_seaborn_recipes.html">Seaborn Object Recipes</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Big Data &amp; Performance</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/10_big_data_what_is_it.html">What is Big Data?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/20_big_data_strategies.html">Big Data Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/30_parquet.html">Parquet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/object_vectors.html">Object dtypes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/50_performance_solutions.html">Solving Performance Issues</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/60_parallelism.html">Parallel Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/30_big_data/70_dask.html">Distributed Computing with dask</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Geospatial Analysis</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/10_gis_what_is_gis.html">What is GIS?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/15_gis_setup_geopandas.html">Installing Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/20_gis_geopandas.html">GIS with Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/30_gis_spatial_joins.html">Merging Spatial Data Sets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/40_gis_projections.html">Spatial Projections</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/50_gis_crs_geopandas.html">Managing Projections in Geopandas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/60_gis_data.html">Spatial Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/40_gis/70_gis_mapping.html">Mapping with Geopandas</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Practical Skills and Concepts</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/10_debugging_principles.html">Debugging</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/20_debugging_in_vscode.html">Debugging Python in VS Code</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/defensive_programming.html">Defensive Programming</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/defensive_programming_tests.html">Testing in a Data Analysis Workflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/defensive_programming_readability.html">Readability</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/defensive_programming_duplicate.html">Don’t Duplicate Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/defensive_programming_collaboration.html">Collaboration</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/iceberg_principle.html">The Iceberg Principle</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/workflow.html">Workflow Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/getting_help.html">Getting Help Online</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/vars_v_objects.html">Python: Variables vs. Objects</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/python_v_r.html">Python vs. R: Important Differences To Be Aware Of</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/backwards_design.html">Backwards Design</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/ints_and_floats.html">Numbers in Computers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/writing_good_jupyter_notebooks.html">Writing Good Jupyter Notebooks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/pr_review.html">Reviewing Code on Github</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/20_programming_concepts/conda_environments.html">conda Environments</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Statistical Modelling</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../week_3/20_inference_v_prediction.html">Inference vs. Prediction Data Science</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_3/30_linear_regression_in_python.html">Linear Regression in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_3/15_brief_intro_categorical_variables.html">Categorical Variables, Indicator Variables and Linear Regression</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_3/35_pandas_to_numpy_with_patsy.html">Pulling Back the Curtain: Pandas to Numpy with patsy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../week_3/40_linear_regression_extensions.html">OPTIONAL: Beyond The Basic Model</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Professional Advice</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/99_advice/buying_datascience_computer.html">How To Buy A Computer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/99_advice/llms.html">chatGPT and You</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/99_advice/PhD_Advice.html">So You’re Thinking About a PhD</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/99_advice/ergonomics_and_adaptive_tech.html">Ergonomics and Adaptive Tech</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../PDS_not_yet_in_coursera/99_advice/mids_electives.html">Duke Data Science Electives</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Miscellaneous</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../../class_2/week_1/00_interactive_console.html">Running Python in the VS Code Interactive Window</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../class_2/week_4/30_managing_python_packages.html">Understanding and Managing Python Packages</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../other/fstrings.html">Combining numbers and text into strings: f-strings</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/nickeubank/practicaldatascience_book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/nickeubank/practicaldatascience_book/issues/new?title=Issue%20on%20page%20%2Fnotebooks/class_5/week_1/2.3.1_plotting_with_plotnine.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../../_sources/notebooks/class_5/week_1/2.3.1_plotting_with_plotnine.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Plotnine and the Grammar of Graphics</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-grammar-of-graphics">The Grammar of Graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-plotnine-and-ggplot2-embodies-the-grammar-of-graphics">How plotnine (and ggplot2) Embodies the Grammar of Graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotnine-gdp-per-capita-and-economic-development">plotnine, GDP per Capita, and Economic Development</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-wdi-data">Loading WDI Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-descriptive-plotting">Basic Descriptive Plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-more-channels">Adding More Channels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-encoding-channel-hierarchy">The Encoding Channel Hierarchy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#layering">Layering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-specific-encodings">Layer-Specific Encodings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-titles-labelling-axes">Adding Titles Labelling Axes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#themes">Themes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-and-editing-a-plotnine-plot-as-matplotlib-axes">Converting and Editing a plotnine Plot as Matplotlib Axes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-up">Next Up</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="plotnine-and-the-grammar-of-graphics">
<h1>Plotnine and the Grammar of Graphics<a class="headerlink" href="#plotnine-and-the-grammar-of-graphics" title="Link to this heading">#</a></h1>
<p>Plotting is one of the most important tools of data science, not only for effectively communicating findings to others, but also for exploring and understanding data for oneself. Plotting data allows us to leverage the astounding ability of humans to recognize visual patterns to help us understand data. To do so effectively, however, we need to think carefully about how our visual pattern recognition abilities work, and how we can use that knowledge to effectively present our data.</p>
<p>In this reading, we will learn all about how to make plots using the <a class="reference external" href="https://plotnine.org/">plotnine</a> plotting library for statistical data visualization (which emulates the ggplot library from R in Python).</p>
<p>Before we dive into the specifics of the package, however, we need to talk about the philosophy of data visualizations that underlies how it works: the <em>Grammar of Graphics</em>.</p>
<section id="the-grammar-of-graphics">
<h2>The Grammar of Graphics<a class="headerlink" href="#the-grammar-of-graphics" title="Link to this heading">#</a></h2>
<p>The <em>Grammar of Graphics</em> is a framework for thinking about visualization developed by <a class="reference external" href="https://www.amazon.com/gp/product/0387245448/">Leland Wilkinson</a>. Its core idea is that any visualization can be decomposed into several constituent parts:</p>
<ul class="simple">
<li><p><strong>The Data:</strong> at the core of any visualization, of course, is the data that were hoping to visualize.</p></li>
<li><p><strong>Geometries:</strong> To visualize our data, we must of course represent the data with actual <em>geometries</em> (geometric objects) on our figure. These include not only the axes that give our figure form, but also points, circles, bars, or other geometric shapes that populate our figure.</p></li>
<li><p><strong>Encoding or “Aesthetic Mappings”:</strong> Finally, to tie our data to the marks in our figure, we must decide on a mapping from data to marks. This <em>encoding</em> of data into visual features is where the magic happens. In order to represent our data in a figure, we must <em>encode</em> different aspects of our data into the various visual features of our figure. For example, in a simple scatter plot, we <em>encode</em> information about one variable in the location of points along the x-axis, and encode information about another variable in locations along the y-axis. Then in the resulting figure, we would say that we have encoded information about two input variables in the location of points in our figure. Note encodings are sometimes referred to as “aesthetic mappings,” but I will confess I find that confusing.</p></li>
<li><p><strong>Channels:</strong> The visual features of our plot into which we may encode information are called “channels.” Some channels are obvious — in a scatter plot, for example, one channel may be the location of points along the x-axis while another channel is the location of points along the y-axis. But there are other channels into which we can also encode data, like the size, shape, or color of points (e.g. making points larger for, say, more populous countries). Each of these different ways information can be encoded is called a “channel.”</p></li>
</ul>
<p>Putting these together, we can say that when we make a figure, we are communicating information about our <em>data</em> by <em>encoding</em> information about the value of different variables in the different <em>channels</em> made possible my our <em>marks</em>.</p>
<p>(To be clear, there are some really interesting nuances to Wilkinson’s work that I can’t do justice to in the space I have here, including discussion of scales, which I’m ignoring for now, but those are the basics!)</p>
<p>This decomposition is especially powerful because it gives rise to a model of graphics that is inherently <em>modular</em> and <em>composable</em>. This is not only helpful when thinking about how to make a good data visualization, but as we will see it is also an obvious foundation for a modular, composable way to specify figures in code. Indeed, it is for this reason that so many popular plotting libraries had been organized around the Grammar of Graphics, including not only the package we will focus on today (seaborn), but also the immensely popular ggplot in R, Altair in Python, Vega in Javascript, and more.</p>
</section>
<section id="how-plotnine-and-ggplot2-embodies-the-grammar-of-graphics">
<h2>How plotnine (and ggplot2) Embodies the Grammar of Graphics<a class="headerlink" href="#how-plotnine-and-ggplot2-embodies-the-grammar-of-graphics" title="Link to this heading">#</a></h2>
<p>Before diving into the nuances of seaborn, let’s begin with a simple example to illustrate how the Grammar of Graphics (GoG) manifests in code. In the example below, let’s use a canonical example dataset on penguins (which comes included with seaborn) to examine the relationship between penguin mass and other physical features:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Import pandas and seaborn.objects</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">plotnine</span> <span class="k">as</span> <span class="nn">pn</span>
<span class="kn">from</span> <span class="nn">plotnine</span> <span class="kn">import</span> <span class="n">aes</span>  <span class="c1"># We use aes so much worth a direct import.</span>

<span class="n">pd</span><span class="o">.</span><span class="n">set_option</span><span class="p">(</span><span class="s2">&quot;mode.copy_on_write&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>

<span class="c1"># Load penguins dataset</span>
<span class="kn">from</span> <span class="nn">plotnine.data</span> <span class="kn">import</span> <span class="n">penguins</span>

<span class="n">penguins</span> <span class="o">=</span> <span class="n">penguins</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">penguins</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>species</th>
      <th>island</th>
      <th>bill_length_mm</th>
      <th>bill_depth_mm</th>
      <th>flipper_length_mm</th>
      <th>body_mass_g</th>
      <th>sex</th>
      <th>year</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.1</td>
      <td>18.7</td>
      <td>181.0</td>
      <td>3750.0</td>
      <td>male</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.5</td>
      <td>17.4</td>
      <td>186.0</td>
      <td>3800.0</td>
      <td>female</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>40.3</td>
      <td>18.0</td>
      <td>195.0</td>
      <td>3250.0</td>
      <td>female</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>36.7</td>
      <td>19.3</td>
      <td>193.0</td>
      <td>3450.0</td>
      <td>female</td>
      <td>2007</td>
    </tr>
    <tr>
      <th>5</th>
      <td>Adelie</td>
      <td>Torgersen</td>
      <td>39.3</td>
      <td>20.6</td>
      <td>190.0</td>
      <td>3650.0</td>
      <td>male</td>
      <td>2007</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Let us start by just looking at the relationship between body mass and bill length:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;body_mass_g&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/799a1e20a5acfa16e213677030b5b918861a66a77b2a6f330ff458bfd987df8d.png"><img alt="../../../_images/799a1e20a5acfa16e213677030b5b918861a66a77b2a6f330ff458bfd987df8d.png" src="../../../_images/799a1e20a5acfa16e213677030b5b918861a66a77b2a6f330ff458bfd987df8d.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Here, you can see that the first thing we’ve passed is our <em>Data</em> (<code class="docutils literal notranslate"><span class="pre">penguins</span></code>), we’ve added <code class="docutils literal notranslate"><span class="pre">geom_point()</span></code> as our <em>Geometries</em>, and we’ve <em>encoded</em> <code class="docutils literal notranslate"><span class="pre">bill_length_mm</span></code> into the x-axis location of our points, and <code class="docutils literal notranslate"><span class="pre">body_mass_g</span></code> into the y-axis location of our points.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">aes</span></code> function is where features of the data are <em>encoded</em> to specific features of the plot. <code class="docutils literal notranslate"><span class="pre">aes</span></code> is short for <code class="docutils literal notranslate"><span class="pre">aesthetics</span></code>, and plotnine (like ggplot) refers to the encoding of data properties to visual elements of the plot as “aesthetic mappings.”</p>
<p>As I said before, the most powerful part of a GoG-inspired syntax is that it’s extremely modular. Suppose, looking at this, we notice a strong upward trend through the middle of the data, but also a weird mass in the bottom right. What might that be? Well, let’s go fishing! Let’s encode some additional information in our figure through the <em>channel</em> of dot color:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;body_mass_g&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;sex&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/1c1d9b6d98935b10f88218e586c0e08ba3b3c2147e803ce5a1f1da6acb60bd10.png"><img alt="../../../_images/1c1d9b6d98935b10f88218e586c0e08ba3b3c2147e803ce5a1f1da6acb60bd10.png" src="../../../_images/1c1d9b6d98935b10f88218e586c0e08ba3b3c2147e803ce5a1f1da6acb60bd10.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Great! And just like that, we can easily see that while female penguins do tend to be smaller than their male counterparts, that doesn’t explain this weird shape of the data. Slits and code a different variable — <code class="docutils literal notranslate"><span class="pre">species</span></code>!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span><span class="n">penguins</span><span class="p">,</span> <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;bill_length_mm&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;body_mass_g&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;species&quot;</span><span class="p">))</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<a class="reference internal image-reference" href="../../../_images/7652dd1c93b49786975a8ea0aee9bdfed8631e8242ab5e68e332f78b6bace0fd.png"><img alt="../../../_images/7652dd1c93b49786975a8ea0aee9bdfed8631e8242ab5e68e332f78b6bace0fd.png" src="../../../_images/7652dd1c93b49786975a8ea0aee9bdfed8631e8242ab5e68e332f78b6bace0fd.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Ah, there we go! That’s clearly what explains much of this shape.</p>
<p>Notice how powerful that was — we were able to think in terms of the features of the data we wanted to understand, and we were able to uncover a pattern relatively quickly that would have been extremely difficult to <a class="reference external" href="https://en.wikipedia.org/wiki/Grok">grok</a> (really understand at an intuitive level) using summary statistics or non-visual data tabulations.</p>
</section>
<section id="plotnine-gdp-per-capita-and-economic-development">
<h2>plotnine, GDP per Capita, and Economic Development<a class="headerlink" href="#plotnine-gdp-per-capita-and-economic-development" title="Link to this heading">#</a></h2>
<p>To better demonstrate not only the ins-and-outs of the seaborn plotting library, but also how plotting can be used for exploratory data analysis, let’s take a look at the relationship between average income and different measures of human development.</p>
<p>Among people who are interested in trying to improve living conditions in developing countries around the world, one canonical debate is about whether the best way to help those most in need is to focus on encouraging economic growth writ large, or whether it would make more sense to focus on specific interventions around things like infant mortality or the education of girls.</p>
<p>Many economists argue that encouraging economic growth may actually be the most efficient way of achieving improvements in human development not because economic growth itself is intrinsically valuable, but because economic growth tends to be associated with improvements in lots of other things that we care about, presumably because a better functioning economy and wealthier citizens are better able to build the institutions and public service delivery systems necessary to provide access to schools and public health everyone.</p>
<p>Others argue that efforts to encourage economic growth are targeting an outcome that we don’t actually care about (income) rather than targeting the things that we are actually trying to encourage (higher life expectancy, equal access to education, etc.). In this view, targeting the specific outcomes is much more likely to help us achieve the things that we care about most.</p>
<p>(Of course, it’s worth emphasizing that this way of framing the debate is simplistic – this is not an either/or proposition, and efforts can be directed in both directions. But in a world of scarce resources, practitioners do sometimes have to decide whether they allocate resources to encouraging economic growth through, say, small business loans versus putting money into building schools.)</p>
<p>In an effort to move beyond debating this in the abstract, in this lesson we will use Altair to look at patterns between economic growth (measured in terms of average incomes in different countries, measured as Gross Domestic Product (GDP) per capita) and other development outcomes (life expectancy, literacy, etc.). We will be doing so using data from the World Development Indicators (WDI) database from the World Bank that provides country-level data on a range of outcomes.</p>
</section>
<section id="loading-wdi-data">
<h2>Loading WDI Data<a class="headerlink" href="#loading-wdi-data" title="Link to this heading">#</a></h2>
<p>The data we’ll be using can be found <a class="reference external" href="https://raw.githubusercontent.com/nickeubank/practicaldatascience/master/Example_Data/wdi_plotting.csv">here</a>. This is <em>basically</em> straight from the <a class="reference external" href="https://datacatalog.worldbank.org/dataset/world-development-indicators">WDI website</a>, though I’ve made a couple small formatting changes to make life a little easier.</p>
<p>Let’s begin by loading the data and getting a quick sense of what we have:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">wdi_data</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;https://raw.githubusercontent.com/nickeubank/&quot;</span>
    <span class="s2">&quot;practicaldatascience/master/Example_Data/wdi_plotting.csv&quot;</span>
<span class="p">)</span>
<span class="n">world</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">wdi_data</span><span class="p">)</span>
<span class="n">world</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Year</th>
      <th>Country Name</th>
      <th>Country Code</th>
      <th>GDP per capita (constant 2010 US$)</th>
      <th>Population, total</th>
      <th>CO2 emissions (metric tons per capita)</th>
      <th>Mortality rate attributed to household and ambient air pollution, age-standardized (per 100,000 population)</th>
      <th>PM2.5 air pollution, population exposed to levels exceeding WHO guideline value (% of total)</th>
      <th>Life expectancy at birth, total (years)</th>
      <th>Mortality rate, under-5 (per 1,000 live births)</th>
      <th>Literacy rate, youth female (% of females ages 15-24)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2475</th>
      <td>1982</td>
      <td>Iceland</td>
      <td>ISL</td>
      <td>NaN</td>
      <td>233860.0</td>
      <td>6.836620</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>77.037805</td>
      <td>8.7</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>10613</th>
      <td>2019</td>
      <td>Tunisia</td>
      <td>TUN</td>
      <td>4404.992787</td>
      <td>11694721.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>76.699000</td>
      <td>16.9</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4080</th>
      <td>1989</td>
      <td>Slovenia</td>
      <td>SVN</td>
      <td>NaN</td>
      <td>1996351.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>72.704878</td>
      <td>11.1</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>5969</th>
      <td>1998</td>
      <td>Lebanon</td>
      <td>LBN</td>
      <td>5899.938790</td>
      <td>3693514.0</td>
      <td>4.399604</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>73.528000</td>
      <td>22.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>6202</th>
      <td>1999</td>
      <td>Mauritius</td>
      <td>MUS</td>
      <td>5285.549777</td>
      <td>1175267.0</td>
      <td>1.871915</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>70.960976</td>
      <td>20.4</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>We can also look at the columns in the dataset a little more systematically:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">world</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Year
Country Name
Country Code
GDP per capita (constant 2010 US$)
Population, total
CO2 emissions (metric tons per capita)
Mortality rate attributed to household and ambient air pollution, age-standardized (per 100,000 population)
PM2.5 air pollution, population exposed to levels exceeding WHO guideline value (% of total)
Life expectancy at birth, total (years)
Mortality rate, under-5 (per 1,000 live births)
Literacy rate, youth female (% of females ages 15-24)
</pre></div>
</div>
</div>
</div>
<p>And finally, we can look at the years that are included in the data:,</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="o">.</span><span class="n">Year</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    10850.000000
mean      1995.500000
std         14.431535
min       1971.000000
25%       1983.000000
50%       1995.500000
75%       2008.000000
max       2020.000000
Name: Year, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>And the number of countries (although we can already see from the sample above that not all countries have all variables defined in every year):</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># How many countries?</span>
<span class="n">world</span><span class="p">[</span><span class="s2">&quot;Country Name&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">nunique</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>217
</pre></div>
</div>
</div>
</div>
</section>
<section id="basic-descriptive-plotting">
<h2>Basic Descriptive Plotting<a class="headerlink" href="#basic-descriptive-plotting" title="Link to this heading">#</a></h2>
<p>Given our interest in the relationship between average income and human development, let’s start by looking at the relationship GDP per capita and the standard measure of the quality of public health in a country: the mortality rate for young children.</p>
<p>To start, let’s also limit our attention to data from a single year – we can look at variation over time later.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span> <span class="o">=</span> <span class="n">world</span><span class="p">[</span><span class="n">world</span><span class="o">.</span><span class="n">Year</span> <span class="o">==</span> <span class="mi">2018</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;GDP per capita (constant 2010 US$)&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Mortality rate, under-5 (per 1,000 live births)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/52776ac7991ca568fe6b2513049f5448a5347381d5318ce40c70011ba7fb6ff8.png"><img alt="../../../_images/52776ac7991ca568fe6b2513049f5448a5347381d5318ce40c70011ba7fb6ff8.png" src="../../../_images/52776ac7991ca568fe6b2513049f5448a5347381d5318ce40c70011ba7fb6ff8.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Here we immediately see one of the great things about plotting – we can instantly recognize that this relationship is not remotely linear, which is important to know because it means any analysis designed to measure linear relationships (like a simple correlation or a linear regression) would be misleading. Moreover, not only do we see it’s non-linear, but we can get a sense of the <em>way</em> in which it’s non-linear!</p>
<p>(Yes, there are ways to learn this without plotting, but those approaches tend not to tell us what functional form the relationship actually takes, and can often be fooled by certain non-linear relationships in a way your eye is not! Indeed, even the standard way of validating the linearity assumption in a linear regression is to <strong>plot</strong> your residuals for this precisely reason.)</p>
<p>So let’s log our variables to get something more linear and easy to interprete:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="p">[</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">world</span><span class="p">[</span><span class="s2">&quot;GDP per capita (constant 2010 US$)&quot;</span><span class="p">])</span>
<span class="n">world</span><span class="p">[</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
    <span class="n">world</span><span class="p">[</span><span class="s2">&quot;Mortality rate, under-5 (per 1,000 live births)&quot;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">world</span><span class="p">[</span><span class="s2">&quot;log_population&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">world</span><span class="p">[</span><span class="s2">&quot;Population, total&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/7fe19ceba1427c365e816dc5234c7e44894670a886cb5d7e10cdb0dd767d89d0.png"><img alt="../../../_images/7fe19ceba1427c365e816dc5234c7e44894670a886cb5d7e10cdb0dd767d89d0.png" src="../../../_images/7fe19ceba1427c365e816dc5234c7e44894670a886cb5d7e10cdb0dd767d89d0.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p><em>Much</em> better. Here we can clearly see a nice, linear relationship between logged GDP per capita and logged child mortality.</p>
</section>
<section id="adding-more-channels">
<h2>Adding More Channels<a class="headerlink" href="#adding-more-channels" title="Link to this heading">#</a></h2>
<p>So far we’ve made great progress on the question we were asking: does average income seem to be strongly correlated with childhood morality? Yes, they are clearly strongly correlated, though with some dispersion of outcomes at each income level.</p>
<p>But as we saw above, we have more than 200 countries in this dataset, and each country is represented by a single point in that figure. This is equitable, but perhaps misleading – if we’re interested in human welfare, then not all countries are equally important; after all, nearly half of all people alive live in <a class="reference external" href="https://www.pewresearch.org/fact-tank/2018/07/11/world-population-day/#:~:text=More%20than%20half%20of%20all%20people%20around%20the,population%20%281.42%20billion%29%2C%20followed%20by%20India%20%281.35%20billion%29.">only 7 countries</a>! What if this relationship between childhood mortality is true for small countries, but not big ones, but we can’t see it because all countries are being plotted the same way?</p>
<p>One way to address this is to encode additional data – the population of each country – to another channel. The location of points on x and y axes are, of course, the most obvious encoding channels in a visualization, but they are <em>far</em> from the only ones available! Indeed, Altair allows information to be encoded in a range of mark features, including:</p>
<ul class="simple">
<li><p>Color</p></li>
<li><p>Size</p></li>
<li><p>Shape</p></li>
<li><p>Stroke (for lines)</p></li>
<li><p>Opacity</p></li>
</ul>
<p>and more.</p>
<p>So let’s add one of these to our data – let’s encode population in the size of our points, so big countries get bigger points! That way we can see if big countries also seem to be following this trend we see:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/34a5d84a9b982dd14f193478feb0868836c0b684e1e18d82d260aabaa86e841c.png"><img alt="../../../_images/34a5d84a9b982dd14f193478feb0868836c0b684e1e18d82d260aabaa86e841c.png" src="../../../_images/34a5d84a9b982dd14f193478feb0868836c0b684e1e18d82d260aabaa86e841c.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>And just like that we have added <em>substantial</em> information to our figure! In this case, what we’ve learned is that the linear relationship we see for all countries is similar to the linear relationship we see if we focus only on big countries (since we see the bigger circles distributed all along the same general line as the smaller points), which should re-assure use that the relationship we see holds both for the average country <em>and</em> for the average person.</p>
</section>
<section id="the-encoding-channel-hierarchy">
<h2>The Encoding Channel Hierarchy<a class="headerlink" href="#the-encoding-channel-hierarchy" title="Link to this heading">#</a></h2>
<p>In the figure above, we encoded GDP per capita to each point’s x-axis location, Mortality to each point’s y-axis location, and population to point size. But why are encoding GDP and Mortality to x-y locations, and population to size? We could have just as easily encoded population in x-axis locations, and GDP in size:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">world</span><span class="p">[</span><span class="s2">&quot;log_population&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">world</span><span class="p">[</span><span class="s2">&quot;Population, total&quot;</span><span class="p">])</span>
<span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_population&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;GDP per capita (constant 2010 US$)&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/ad9ba6b2788e797a855456acc6ffbfedf8dc1d2da502dbc4d6f675a89ce99c6e.png"><img alt="../../../_images/ad9ba6b2788e797a855456acc6ffbfedf8dc1d2da502dbc4d6f675a89ce99c6e.png" src="../../../_images/ad9ba6b2788e797a855456acc6ffbfedf8dc1d2da502dbc4d6f675a89ce99c6e.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>But when we look at that figure, we immediately get the sense we’ve done something wrong. Why?</p>
<p>The answer is that not all encoding channels are created equal. Our visual pattern recognition system is more sensitive to some channels (like x-y locations) than others (size). In the figure above, for example, the pattern between GDP and Mortality is still present, the problem is that it manifests as the marks being ever so slightly larger at the bottom of the figure than at a top, a difference that’s really hard to see.</p>
<p>(Why is this the case? While it’s always dangerous to play armchair evolutionary biologist, it’s not hard to imagine a reason we are so sensitive to location. Misperceive the location of an object even a little and your spear throw goes awry, or you foot misses the rock you were trying to step on. Misperceive the size of an apple a little and… well, there are probably no consequences!)</p>
<p>This idea of a hierarchy of encoding channels is explored in detail in Jacques Berin’s <em>Semiology of Graphics</em>. As with the Grammer of Graphnics, I won’t go into all of the thoughtful nuance from the original book, but in short Jacques argues that the top of the channel hierarchy is (in decreasing order of desirability):</p>
<ul class="simple">
<li><p>Position</p></li>
<li><p>Size</p></li>
<li><p>Color</p></li>
<li><p>Shape</p></li>
</ul>
<p>(There are all sorts of nuance for data that’s categorical versus cardinal, and different rules for points versus lines versus shapes, but crucially in <em>all</em> cases position is at the top!)</p>
<p>And that’s why this figure seems so wrong – we haven’t used position to encode the relationship we care about <strong>most</strong>, but instead used a mixture of position (for Mortality) and size (for GDP per capita), obscuring what we most want to understand.</p>
<p>In our original figure, by contrast, we encoded a <em>secondary</em> variable of interest (population) into a secondary channel (size). And given we only wanted to quickly see if the relationship we were seeing was a relationship that was true for both large and small countries, this secondary channel was sufficient. But it’s not sufficient for GDP per capita.</p>
</section>
<section id="layering">
<h2>Layering<a class="headerlink" href="#layering" title="Link to this heading">#</a></h2>
<p>One feature of this plot is that we see a significant relationship between GDP per capita and child mortality, but we also see that there is some dispersion of outcomes around that trend – even at the same income level, some countries are outperforming others in terms of reducing child mortality.</p>
<p>To make this easier to visualize, it may be helpful to add a line-of-best-fit (e.g. a linear regression line) to our plot — something that seaborn (as a statistical data visualization library) makes very easy!</p>
<p>First, we need to recognize that we’re trying to add a new <em>Geometry</em> to our figure — in this case, a line. We do this by adding <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">geom_smooth(method=&quot;lm&quot;)</span></code> to the end of our current plot. In this case, <code class="docutils literal notranslate"><span class="pre">method=&quot;lm&quot;</span></code> means we want a linear model (linear regression) fit on the data, but you can also pass arguments like <code class="docutils literal notranslate"><span class="pre">&quot;lowess&quot;</span></code> for a lowess fit.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/7edefe377ba0e2d97cebadcf6aebcea3b09343f0fedc49120f0cd2cb1bcd014d.png"><img alt="../../../_images/7edefe377ba0e2d97cebadcf6aebcea3b09343f0fedc49120f0cd2cb1bcd014d.png" src="../../../_images/7edefe377ba0e2d97cebadcf6aebcea3b09343f0fedc49120f0cd2cb1bcd014d.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<section id="layer-specific-encodings">
<h3>Layer-Specific Encodings<a class="headerlink" href="#layer-specific-encodings" title="Link to this heading">#</a></h3>
<p>On nuance to encodings (aesthetic mappings) with multiple geometries is that one must be careful about <em>how</em> one specifies an encoding, as encodings specified in different ways will apply either to all marks, or only to one mark.</p>
<p>Basically, if you specify an encoding inside <code class="docutils literal notranslate"><span class="pre">ggplot(aes())</span></code>, it will apply to all geometries. If, by contrast, you add an encoding <em>inside</em> a specific geometry’s <code class="docutils literal notranslate"><span class="pre">aes()</span></code> function, it will only apply to that geometry. And if you want to just modify a geometry (not by encoding it to a variable, but just change a setting), you put that change in the geometry itself (e.g., <code class="docutils literal notranslate"><span class="pre">geom_point(size=10)</span></code>).</p>
<p>Here’s a great visual from the seaborn documentation on this point (they use the term “mapped” instead of “encoded”):</p>
<p><img alt="plotnine encoding rules" src="../../../_images/objects_interface_encodings.svg" /></p>
<p>We can also see how this kind of layer-specific specification works through the addition of the names of countries to our plot. This gets pretty busy and this is probably too much on a plot, but it’s the kind of thing that can be useful for data exploration.</p>
<p>First, we want to add a new geometry: <code class="docutils literal notranslate"><span class="pre">pn.geom_text()</span></code>. But if we want to country codes into our text labels by adding <code class="docutils literal notranslate"><span class="pre">&quot;label=Country</span> <span class="pre">Code&quot;</span></code> and not making other changes, nothing happens:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Country Code&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_text</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_text : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/8af44b91c13e4d522ea83b09f2426c698317031cdc1e8d12cb896193b6f63499.png"><img alt="../../../_images/8af44b91c13e4d522ea83b09f2426c698317031cdc1e8d12cb896193b6f63499.png" src="../../../_images/8af44b91c13e4d522ea83b09f2426c698317031cdc1e8d12cb896193b6f63499.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Why? Well, what’s actually happening is that size isn’t just changing the size of our dots, it’s also changing the size of the text labels. For most countries, that makes them unreadably small, and for China and India, the text label is small enough you can’t see it because of the big points.</p>
<p>We can see this if we use <code class="docutils literal notranslate"><span class="pre">alpha</span></code> to make our points more transparent (<code class="docutils literal notranslate"><span class="pre">alpha</span></code> is a measure of opacity — 1 is opaque and 0 is transparent). Note I am not mapping the alpha property onto something in the data, so I will keep it outside of <code class="docutils literal notranslate"><span class="pre">aes</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Country Code&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_text</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_text : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/1f7351018dc80b93ed518aca2c2f134a1e027c6b963edb61de977b8deec6e61a.png"><img alt="../../../_images/1f7351018dc80b93ed518aca2c2f134a1e027c6b963edb61de977b8deec6e61a.png" src="../../../_images/1f7351018dc80b93ed518aca2c2f134a1e027c6b963edb61de977b8deec6e61a.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Oof!  Now the text labels are too big! But now we can set size separately for text labels:</p>
<p>So let’s move size out of the main <code class="docutils literal notranslate"><span class="pre">aes</span></code> and down into <code class="docutils literal notranslate"><span class="pre">geom_point</span></code>:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Country Code&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_text : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/8dc18f6821d47f134083d902772f3c322bbf82c6b6589e1c42ac5a79418c594d.png"><img alt="../../../_images/8dc18f6821d47f134083d902772f3c322bbf82c6b6589e1c42ac5a79418c594d.png" src="../../../_images/8dc18f6821d47f134083d902772f3c322bbf82c6b6589e1c42ac5a79418c594d.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
<p>Much better! Still not something I’d put in a paper, but that’s it’s helpful if I wanted to, say, figure out who my outliers were (like Nigeria, <code class="docutils literal notranslate"><span class="pre">NGA</span></code>).</p>
<p>Of course, we might also want to make this more readable by just dropping our Dots and just using text labels.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Country Code&quot;</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_text</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_text : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/d1962597c665990dd208c9fa54702f081fd15f8c11bc3631cefe1569023a36e2.png"><img alt="../../../_images/d1962597c665990dd208c9fa54702f081fd15f8c11bc3631cefe1569023a36e2.png" src="../../../_images/d1962597c665990dd208c9fa54702f081fd15f8c11bc3631cefe1569023a36e2.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
</section>
</section>
<section id="adding-titles-labelling-axes">
<h2>Adding Titles Labelling Axes<a class="headerlink" href="#adding-titles-labelling-axes" title="Link to this heading">#</a></h2>
<p>Now suppose you wanted to share what you’d discovered – you’d probably want to clean up your variables names and titles! Thankfully, it’s <em>very</em> easy! Just add <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">labs()</span></code> and the labels you want:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">labs</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Log GDP per Capita&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Log Under-5 Mortality&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Income and Child Mortality&quot;</span><span class="p">,</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/2ca9c7bc3f272485b013d8123d2148dad2321c47553cbc90d8c1d658a1ed612c.png"><img alt="../../../_images/2ca9c7bc3f272485b013d8123d2148dad2321c47553cbc90d8c1d658a1ed612c.png" src="../../../_images/2ca9c7bc3f272485b013d8123d2148dad2321c47553cbc90d8c1d658a1ed612c.png" style="width: 640px; height: 480px;" /></a>
</div>
</div>
</section>
<section id="themes">
<h2>Themes<a class="headerlink" href="#themes" title="Link to this heading">#</a></h2>
<p>Want to customize the look of your plots? Great! plotnine has all the default themes you’re used to <a class="reference external" href="https://ggplot2.tidyverse.org/reference/ggtheme.html#ref-examples">from ggplot (examples at the bottom)</a>, plus a few more and the ability to customize. Here’s the <a class="reference external" href="https://plotnine.org/reference/#themes">official list</a> and a guide on their <a class="reference external" href="https://plotnine.org/guide/overview.html#theme_-styling">use here</a>.</p>
<p>Just add <code class="docutils literal notranslate"><span class="pre">+</span> <span class="pre">pn.theme_[name]()</span></code> to your figure to adopt a theme. And add <code class="docutils literal notranslate"><span class="pre">.to_retina()</span></code> if you like retina sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">labs</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Log GDP per Capita&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Log Under-5 Mortality&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Income and Child Mortality&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">theme_light</span><span class="p">()</span><span class="o">.</span><span class="n">to_retina</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/abd562ff1affe9bd0ff623813cdb45fd8314176fc1c7439e948c0bc72c8b1bfc.png"><img alt="../../../_images/abd562ff1affe9bd0ff623813cdb45fd8314176fc1c7439e948c0bc72c8b1bfc.png" src="../../../_images/abd562ff1affe9bd0ff623813cdb45fd8314176fc1c7439e948c0bc72c8b1bfc.png" style="width: 1280px; height: 960px;" /></a>
</div>
</div>
<p>In theory you can made arbitrary modifications to themes, though I’ll admit that this is something I’ve struggled with in the plotnine documentation. But here’s a change in font:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">labs</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Log GDP per Capita&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Log Under-5 Mortality&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Income and Child Mortality&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s2">&quot;Fira Sans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_retina</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<a class="reference internal image-reference" href="../../../_images/16872f9937c8ecca4036f328e60d56c2947278a6e9602a0d03812d6dfd3b447b.png"><img alt="../../../_images/16872f9937c8ecca4036f328e60d56c2947278a6e9602a0d03812d6dfd3b447b.png" src="../../../_images/16872f9937c8ecca4036f328e60d56c2947278a6e9602a0d03812d6dfd3b447b.png" style="width: 1280px; height: 960px;" /></a>
</div>
</div>
<p>You can also set a theme globally at load with <code class="docutils literal notranslate"><span class="pre">set_theme</span></code>, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pn</span><span class="o">.</span><span class="n">set_theme</span><span class="p">(</span><span class="n">pn</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s2">&quot;Fira Sans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_retina</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="converting-and-editing-a-plotnine-plot-as-matplotlib-axes">
<h2>Converting and Editing a plotnine Plot as Matplotlib Axes<a class="headerlink" href="#converting-and-editing-a-plotnine-plot-as-matplotlib-axes" title="Link to this heading">#</a></h2>
<p>One of the best features of plotnine is that is you find plotnine won’t do something you want, you can always convert your <code class="docutils literal notranslate"><span class="pre">plotnine</span></code> plot to a matplotlib axes. To do so, simply create a pyplot figure, then use the <code class="docutils literal notranslate"><span class="pre">.on().show()</span></code> methods to add your seaborn Plot to that figures. You can then access the single <code class="docutils literal notranslate"><span class="pre">axes</span></code> object in that figure with <code class="docutils literal notranslate"><span class="pre">f.axes[0]</span></code> and edit the way you would any pyplot axes object.</p>
<p>(you do seem to need the <code class="docutils literal notranslate"><span class="pre">.show()</span></code> after the <code class="docutils literal notranslate"><span class="pre">.on()</span></code>!)</p>
<p>Note that you won’t always see the result in the window (as below) if you’re working with a Jupyter Notebook or other interactive visualization tool, but the saved image will have all relevant edits.</p>
<p>Here’s what I see when I load the saved image:</p>
<p><img alt="Reload saved image" src="../../../_images/seaborn_w_matplotlib_title.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">p</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">pn</span><span class="o">.</span><span class="n">ggplot</span><span class="p">(</span>
        <span class="n">world</span><span class="p">,</span>
        <span class="n">pn</span><span class="o">.</span><span class="n">aes</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="s2">&quot;log_gdp_per_cap&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;log_under5_mortality_rate&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="s2">&quot;Population, total&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_point</span><span class="p">()</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s2">&quot;lm&quot;</span><span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">labs</span><span class="p">(</span>
        <span class="n">x</span><span class="o">=</span><span class="s2">&quot;Log GDP per Capita&quot;</span><span class="p">,</span>
        <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Log Under-5 Mortality&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">+</span> <span class="n">pn</span><span class="o">.</span><span class="n">theme_light</span><span class="p">(</span><span class="n">base_family</span><span class="o">=</span><span class="s2">&quot;Fira Sans&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">to_retina</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># Assuming only one axes</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">draw</span><span class="p">()</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Show with `fig` (ax won&#39;t plot)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/nce8/github/plotnine/plotnine/layer.py:370: PlotnineWarning: geom_point : Removed 31 rows containing missing values.
</pre></div>
</div>
<img alt="../../../_images/9be00c9d2a9117eabafdfdecf66250f51ec7baffdb52faac42d75a0c76dbee9b.png" src="../../../_images/9be00c9d2a9117eabafdfdecf66250f51ec7baffdb52faac42d75a0c76dbee9b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;New Title&quot;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/6534239eae22a1eccb77fbcf120eee03bab79bd2af1795f5f8230a3b272610f8.png" src="../../../_images/6534239eae22a1eccb77fbcf120eee03bab79bd2af1795f5f8230a3b272610f8.png" />
</div>
</div>
<p>Note you aren’t <em>exactly</em> getting back a pyplot object. For example, you can’t grab elements by name as you would with a pyplot object, and if you set something that was already created by plotnine, they’ll overlap one another:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlabel</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;test&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;test x label&quot;</span><span class="p">)</span>
<span class="n">fig</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/a71d2a887b9e3f30221ca99321e2169e6464f93be93bc770e408c403cc6ac5ac.png" src="../../../_images/a71d2a887b9e3f30221ca99321e2169e6464f93be93bc770e408c403cc6ac5ac.png" />
</div>
</div>
<p>But it is handy!</p>
</section>
<section id="next-up">
<h2>Next Up<a class="headerlink" href="#next-up" title="Link to this heading">#</a></h2>
<p>In our next reading, we’ll turn to the plotting backend that underlies, <code class="docutils literal notranslate"><span class="pre">matplotlib</span></code>. The fact that plotnine is backed by matplotlib it means that any time you find there’s something you want to do that plotnine hasn’t implemented, you can always fall back into matplotlib to make additional edits. So you feel comfortable doing so, we’ll spend a little time exploring matplotlib itself.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/class_5/week_1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-grammar-of-graphics">The Grammar of Graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#how-plotnine-and-ggplot2-embodies-the-grammar-of-graphics">How plotnine (and ggplot2) Embodies the Grammar of Graphics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plotnine-gdp-per-capita-and-economic-development">plotnine, GDP per Capita, and Economic Development</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-wdi-data">Loading WDI Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-descriptive-plotting">Basic Descriptive Plotting</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-more-channels">Adding More Channels</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-encoding-channel-hierarchy">The Encoding Channel Hierarchy</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#layering">Layering</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#layer-specific-encodings">Layer-Specific Encodings</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-titles-labelling-axes">Adding Titles Labelling Axes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#themes">Themes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#converting-and-editing-a-plotnine-plot-as-matplotlib-axes">Converting and Editing a plotnine Plot as Matplotlib Axes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#next-up">Next Up</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Kyle Bradbury & Nick Eubank
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>